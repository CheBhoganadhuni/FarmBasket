<!DOCTYPE html>
<html lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') === 'true' }"
    x-init="$watch('darkMode', val => localStorage.setItem('darkMode', val))" :class="{ 'dark': darkMode }">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}FarmBasket - Premium Organic Farm{% endblock %}</title>

    <!-- Tailwind CSS -->
    {% load static tailwind_tags %}
    {% tailwind_css %}

    <!-- ‚úÖ ADD CUSTOM FONT -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:wght@600;700;800&display=swap"
        rel="stylesheet">


    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <!-- Custom styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Playfair+Display:wght@600;700;800&display=swap');

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            /* ‚úÖ Changed */
        }

        .font-display {
            font-family: 'Playfair Display', serif;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Glass effect */
        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Neon green accent */
        .text-neon {
            color: #32b848;
        }

        .bg-neon {
            background-color: #32b848;
        }

        .border-neon {
            border-color: #32b848;
        }

        /* Animations */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        /* Cart bubble */
        .cart-bubble {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }

        /* Slide drawer */
        .slide-drawer {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            z-index: 9999;
            transition: right 0.3s ease-in-out;
        }

        .slide-drawer.open {
            right: 0;
        }

        /* Loading skeleton */
        [x-cloak] {
            display: none !important;
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }



        /* Beautiful Dropdowns */
        select.form-control,
        select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2332b848' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px !important;
            border-radius: 8px !important;
            cursor: pointer;
        }

        /* Dropdown options styling */
        select option {
            padding: 12px;
            border-radius: 8px;
            background-color: var(--color-surface);
        }

        /* Dark mode dropdown arrow */
        .dark select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2332b848' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        }


        /* Dark mode colors */
        .dark {
            color-scheme: dark;
        }

        .dark body {
            background: #0f172a !important;
            color: #f1f5f9 !important;
        }

        .dark main {
            background: transparent;
        }

        /* Dark mode safe buttons - green background with dark text */
        .dark .bg-neon {
            background-color: #32b848 !important;
            color: #0f172a !important;
            /* Dark text on green background */
        }

        .dark .btn-primary,
        .dark button.bg-neon,
        .dark a.bg-neon {
            background-color: #32b848 !important;
            color: #0f172a !important;
        }

        /* Dark mode text on green backgrounds */
        .dark .bg-neon .text-neon {
            color: #0f172a !important;
        }

        /* Active/selected states with green background */
        .dark [class*="bg-green"],
        .dark .border-neon.bg-green-50,
        .dark .selected,
        .dark .active {
            background-color: #32b848 !important;
            color: #0f172a !important;
        }

        /* Tab buttons and toggles in dark mode */
        .dark button[class*="border-neon"],
        .dark .border-b-2.border-neon {
            color: #32b848 !important;
            background-color: transparent !important;
        }

        .dark button[class*="border-neon"].bg-green-50,
        .dark button[class*="bg-green"] {
            background-color: #32b848 !important;
            color: #0f172a !important;
        }

        /* Stat cards with green background in dark mode */
        .dark .stat-card,
        .dark [class*="bg-neon"] {
            background-color: #32b848 !important;
            color: #0f172a !important;
        }

        /* Profile stats - keep text visible in both modes */
        .dark .stat-display .text-neon {
            color: #32b848 !important;
            /* Keep green text */
        }

        .dark .stat-display .text-gray-600 {
            color: #94a3b8 !important;
            /* Light gray in dark mode */
        }


        .dark [class*="bg-neon"] * {
            color: #0f172a !important;
        }

        /* Hover states */
        .dark .hover\:bg-neon:hover,
        .dark .hover\:bg-green-600:hover {
            background-color: #2a9e3d !important;
            color: #0f172a !important;
        }


        .dark .bg-gradient-to-br {
            background: linear-gradient(to bottom right, #1e293b, #0f172a) !important;
        }

        .dark .glass {
            background: rgba(30, 41, 59, 0.8) !important;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        .dark .text-gray-900 {
            color: #f1f5f9 !important;
        }

        .dark .text-gray-800 {
            color: #e2e8f0 !important;
        }

        .dark .text-gray-700 {
            color: #cbd5e1 !important;
        }

        .dark .text-gray-600 {
            color: #94a3b8 !important;
        }

        .dark .text-gray-500 {
            color: #64748b !important;
        }

        .dark .text-gray-400 {
            color: #475569 !important;
        }

        .dark .bg-white {
            background-color: #1e293b !important;
        }

        .dark .bg-gray-50 {
            background-color: #0f172a !important;
        }

        .dark .bg-gray-100 {
            background-color: #1e293b !important;
        }

        .dark .bg-gray-200 {
            background-color: #334155 !important;
        }

        .dark .border-gray-300 {
            border-color: #475569 !important;
        }

        .dark .border-gray-200 {
            border-color: #334155 !important;
        }

        .dark input,
        .dark textarea,
        .dark select {
            background-color: #1e293b !important;
            border-color: #475569 !important;
            color: #f1f5f9 !important;
        }

        .dark input::placeholder,
        .dark textarea::placeholder {
            color: #64748b !important;
        }

        .dark input:focus,
        .dark textarea:focus,
        .dark select:focus {
            border-color: #32b848 !important;
            background-color: #1e293b !important;
        }

        .dark .hover\:bg-gray-100:hover {
            background-color: #334155 !important;
        }

        .dark .hover\:bg-gray-50:hover {
            background-color: #1e293b !important;
        }

        /* Dark mode cards */
        .dark .card,
        .dark [class*="glass"] {
            background: rgba(30, 41, 59, 0.8) !important;
            border-color: rgba(71, 85, 105, 0.3) !important;
        }

        /* Dark mode skeleton */
        .dark .skeleton {
            background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
            background-size: 200% 100%;
        }

        /* Dark mode footer */
        .dark footer {
            background-color: #0f172a !important;
            border-top: 1px solid #334155;
        }

        /* Preserve neon color in dark mode */
        .dark .text-neon,
        .dark .bg-neon,
        .dark .border-neon {
            color: #32b848 !important;
        }

        .dark .bg-neon {
            background-color: #32b848 !important;
        }

        .dark .border-neon {
            border-color: #32b848 !important;
        }

        /* Better glass effect for light mode */
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .glass {
            background: rgba(31, 41, 55, 0.9);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>

<body class="antialiased transition-colors duration-300"
    :class="darkMode ? 'bg-gray-900 text-gray-100' : 'bg-white text-gray-900'">

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 glass transition-colors duration-300" x-data="navbarAuth()">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">

                <!-- Logo -->
                <a href="/" class="flex items-center space-x-2">
                    <span class="text-3xl">üß∫</span>
                    <span class="font-display text-2xl font-bold text-neon">FarmBasket</span>
                </a>



                <!-- Navigation Links -->
                <nav class="hidden md:flex items-center gap-8">
                    <a href="/" class="font-medium hover:text-neon transition relative group">
                        Home
                        <span
                            class="absolute bottom-0 left-0 w-0 h-0.5 bg-neon transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="/products/" class="font-medium hover:text-neon transition relative group">
                        Shop
                        <span
                            class="absolute bottom-0 left-0 w-0 h-0.5 bg-neon transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="/contact/" class="font-medium hover:text-neon transition relative group">
                        Contact
                        <span
                            class="absolute bottom-0 left-0 w-0 h-0.5 bg-neon transition-all duration-300 group-hover:w-full"></span>
                    </a>
                </nav>

                <!-- Right Menu -->
                <div class="flex items-center space-x-4">

                    <!-- Logged In User Menu -->
                    <template x-if="isLoggedIn">
                        <div x-data="{ userMenuOpen: false }" class="relative">
                            <button @click="userMenuOpen = !userMenuOpen"
                                class="flex items-center space-x-2 hover:text-neon transition">
                                <img :src="userAvatar" alt="Avatar"
                                    class="w-8 h-8 rounded-full border-2 border-neon object-cover">
                                <span class="hidden md:block font-medium" x-text="userName"></span>
                            </button>

                            <!-- Dropdown -->
                            <div x-show="userMenuOpen" @click.away="userMenuOpen = false" x-transition
                                class="absolute right-0 mt-2 w-48 glass rounded-lg shadow-lg py-2 z-50">
                                <a href="{% url 'accounts:profile' %}"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                                    üë§ Profile
                                </a>
                                <a href="/cart/"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                                    üõí My Cart
                                </a>
                                <a href="{% url 'accounts:wishlist' %}"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                                    üíö Wishlist
                                </a>
                                <a href="/orders/"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                                    üì¶ My Orders
                                </a>
                                <a href="{% url 'accounts:addresses' %}"
                                    class="block px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                                    üìç Addresses
                                </a>
                                <hr class="my-2 border-gray-700">
                                <a @click.prevent="logout" href="#"
                                    class="block px-4 py-2 text-red-600 hover:bg-gray-100 dark:hover:bg-gray-800 transition cursor-pointer">
                                    üö™ Logout
                                </a>
                            </div>
                        </div>
                    </template>

                    <!-- Not Logged In -->
                    <template x-if="!isLoggedIn">
                        <div class="flex items-center space-x-4">
                            <a href="{% url 'accounts:login' %}" class="hover:text-neon transition">Login</a>
                            <a href="{% url 'accounts:register' %}"
                                class="px-4 py-2 bg-neon text-white rounded-lg hover:bg-green-600 transition">Sign
                                Up</a>
                        </div>
                    </template>

                    <!-- Dark Mode Toggle -->
                    <button @click="darkMode = !darkMode"
                        class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition">
                        <span x-show="!darkMode" class="text-xl">üåô</span>
                        <span x-show="darkMode" class="text-xl">‚òÄÔ∏è</span>
                    </button>



                    <!-- Mobile Menu Toggle -->
                    <button @click="mobileMenuOpen = !mobileMenuOpen" class="md:hidden">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path x-show="!mobileMenuOpen" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            <path x-show="mobileMenuOpen" stroke-linecap="round" stroke-linejoin="round"
                                stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div x-show="mobileMenuOpen" x-transition class="md:hidden pb-4">
                <a href="/" class="block py-2 hover:text-neon transition">Home</a>
                <a href="/products/" class="block py-2 hover:text-neon transition">Products</a>
                <!-- <a href="#about" class="block py-2 hover:text-neon transition">About</a> -->
                <a href="/contact" class="block py-2 hover:text-neon transition">Contact</a>
            </div>
        </div>
    </nav>


    <!-- Main Content -->
    <main class="pt-16 min-h-screen transition-colors duration-300">
        <!-- Messages -->
        {% if messages %}
        <div class="container mx-auto px-4 mt-4">
            {% for message in messages %}
            <div class="p-4 mb-4 rounded-lg {% if message.tags == 'error' %}bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-200{% elif message.tags == 'success' %}bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-200{% else %}bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-200{% endif %}"
                x-data="{ show: true }" x-show="show" x-transition>
                <div class="flex items-center justify-between">
                    <span>{{ message }}</span>
                    <button @click="show = false" class="ml-4 text-lg font-bold">&times;</button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <!-- Copy your existing footer here -->
    <!-- Footer -->
    <footer class=" transition-colors duration-300 glass">
        <div class="container mx-auto px-4 py-12">
            <div class="flex flex-col md:flex-row justify-between items-center gap-8">
                <!-- Branding -->
                <div class="text-center md:text-left">
                    <h3 class="font-display text-3xl font-bold text-neon mb-2">üß∫ FarmBasket</h3>
                    <p class="text-gray-500 dark:text-gray-400 max-w-xs">Connecting you directly with local farmers for
                        the freshest,
                        organic produce.</p>
                </div>

                <!-- Quick Links -->
                <div class="flex gap-8 text-gray-400 font-medium">
                    <a href="/products/" class="hover:text-neon transition">Shop Now</a>
                    <a href="{% url 'orders:track' %}" class="hover:text-neon transition">Track Order</a>
                    <a href="/contact" class="hover:text-neon transition">Contact Us</a>
                </div>

                <!-- Social & Contact -->
                <div class="flex gap-4">
                    <a href="https://github.com/CheBhoganadhuni" target="_blank"
                        class="p-2 bg-white dark:bg-gray-800 shadow-sm rounded-full hover:bg-neon hover:text-white transition text-gray-700 dark:text-gray-300">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                        </svg>
                    </a>
                    <a href="https://www.linkedin.com/in/chetan-bhoganadhuni-bb0678325" target="_blank"
                        class="p-2 bg-white dark:bg-gray-800 shadow-sm rounded-full hover:bg-neon hover:text-white transition text-gray-700 dark:text-gray-300">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
                        </svg>
                    </a>
                    <a href="https://wa.me/917075687685" target="_blank"
                        class="p-2 bg-white dark:bg-gray-800 shadow-sm rounded-full hover:bg-neon hover:text-white transition text-gray-700 dark:text-gray-300">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z" />
                        </svg>
                    </a>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-sm text-gray-500">
                <p class="mb-2">&copy; 2025 FarmBasket. Made with üíö</p>
                <p class="text-xs text-gray-600">Inspired by <a href="https://alpino.store" target="_blank"
                        class="hover:text-neon transition">alpino.store</a></p>
            </div>
        </div>
    </footer>


    <!-- Global Notification Modal - Add BEFORE closing </body> -->
    <div id="globalNotification" x-data="globalNotificationModal()" x-show="show" x-cloak
        @notification-open.window="open($event.detail)" style="display: none;"
        class="fixed inset-0 z-50 flex items-center justify-center p-4">
        <!-- Backdrop -->
        <div @click="close()" class="absolute inset-0 bg-black opacity-50"></div>

        <!-- Modal Content -->
        <div class="relative glass rounded-2xl p-8 max-w-md w-full text-center shadow-2xl transform" @click.stop
            x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-90"
            x-transition:enter-end="opacity-100 scale-100">

            <!-- Icon -->
            <div class="text-6xl mb-4" x-html="icon"></div>

            <!-- Title -->
            <h2 class="font-display text-2xl font-bold mb-4" x-text="title"></h2>

            <!-- Message -->
            <p class="text-gray-600 dark:text-gray-400 mb-6" x-html="message"></p>

            <!-- Buttons -->
            <div class="flex gap-4">
                <button x-show="showCancel" @click="close()"
                    class="flex-1 px-6 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition font-semibold">
                    Cancel
                </button>
                <button @click="confirm()" class="flex-1 px-6 py-3 rounded-lg transition font-semibold" :class="type === 'success' ? 'bg-neon text-white hover:bg-green-600' : 
                        type === 'error' ? 'bg-red-500 text-white hover:bg-red-600' :
                        type === 'warning' ? 'bg-orange-500 text-white hover:bg-orange-600' :
                        'bg-neon text-white hover:bg-green-600'">
                    <span x-text="confirmText"></span>
                </button>
            </div>
        </div>
    </div>

    {% block extra_js %}{% endblock %}

    <script>
        // Global notification modal component
        function globalNotificationModal() {
            return {
                show: false,
                type: 'success',
                icon: '‚úÖ',
                title: '',
                message: '',
                showCancel: false,
                confirmText: 'OK',
                onConfirm: null,

                open(options) {
                    this.type = options.type || 'success';
                    this.title = options.title || 'Success';
                    this.message = options.message || '';
                    this.showCancel = options.showCancel || false;
                    this.confirmText = options.confirmText || 'OK';
                    this.onConfirm = options.onConfirm || null;

                    // Set icon based on type
                    const icons = {
                        'success': '‚úÖ',
                        'error': '‚ùå',
                        'warning': '‚ö†Ô∏è',
                        'info': '‚ÑπÔ∏è',
                        'cart': 'üõí',
                        'delete': 'üóëÔ∏è',
                        'heart': 'üíö'
                    };
                    this.icon = icons[this.type] || '‚úÖ';

                    this.show = true;
                },

                close() {
                    this.show = false;
                    this.onConfirm = null;
                },

                confirm() {
                    if (this.onConfirm) {
                        this.onConfirm();
                    }
                    this.close();
                }
            }
        }

        // ‚úÖ IMPROVED: Global helper function using custom events
        window.showNotification = function (options) {
            // Use Alpine event system instead of direct access
            window.dispatchEvent(new CustomEvent('notification-open', {
                detail: options
            }));
        }
    </script>

    <script>
        // Initialize dark mode from localStorage
        document.addEventListener('alpine:init', () => {
            Alpine.store('darkMode', {
                on: localStorage.getItem('darkMode') === 'true',

                toggle() {
                    this.on = !this.on;
                    localStorage.setItem('darkMode', this.on);
                }
            });
        });
    </script>


    <script>
        function navbarAuth() {
            return {
                isLoggedIn: false,
                userName: '',
                userAvatar: '',
                mobileMenuOpen: false,

                init() {
                    this.checkAuth();
                },

                checkAuth() {
                    const token = localStorage.getItem('access_token');

                    if (!token) {
                        this.isLoggedIn = false;
                        return;
                    }

                    fetch('/api/auth/me', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    })
                        .then(response => {
                            if (response.ok) {
                                return response.json();
                            } else {
                                throw new Error('Invalid token');
                            }
                        })
                        .then(user => {
                            this.isLoggedIn = true;
                            this.userName = user.first_name;
                            this.userAvatar = user.avatar_url;
                        })
                        .catch(err => {
                            this.isLoggedIn = false;
                            localStorage.removeItem('access_token');
                            localStorage.removeItem('refresh_token');
                        });
                },

                logout() {
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token');
                    window.location.href = '{% url "accounts:login" %}';
                }
            }
        }

        // Cart Counter Component
        function navbarCart() {
            return {
                cartCount: 0,

                init() {
                    this.loadCartCount();

                    // Listen for cart updates
                    window.addEventListener('cart-updated', (e) => {
                        this.cartCount = e.detail.count;
                    });

                    // Reload count when page becomes visible
                    document.addEventListener('visibilitychange', () => {
                        if (!document.hidden) {
                            this.loadCartCount();
                        }
                    });
                },

                async loadCartCount() {
                    const token = localStorage.getItem('access_token');
                    if (!token) {
                        this.cartCount = 0;
                        return;
                    }

                    try {
                        const response = await fetch('/api/cart/count', {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.cartCount = data.count;
                        } else {
                            this.cartCount = 0;
                        }
                    } catch (err) {
                        this.cartCount = 0;
                    }
                }
            }
        }
    </script>

</body>

</html>